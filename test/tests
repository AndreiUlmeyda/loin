#!/bin/bats

load 'helpers/bats-support/load'
load 'helpers/bats-assert/load'
load 'helpers/mocks/stub'

# supply your loin base directory here, for instance
# BASEDIR="/home/jellykid/repositories/loin"
BASEDIR=""

function assertSuccessWithOutput {
	assert_success
    assert_output "$1"
}

function assertFailureWithMessage {
	assert_failure
	assert_output "$1"
}

function loin {
	commandUnderTest="$BASEDIR/loin $1"
	run bash -c "$commandUnderTest"
}

@test "called with unsupported argument, it should print a notice" {
	badArg="unintended"
	badArgError='loin error: invalid argument, for now the only valid argument is the flag "--tag"'
	
	loin "$badArg"
	
	assertFailureWithMessage "$badArgError"
}

@test "given one selected bookmark, call xdg-open with url" {
	stub buku 'echo {}'
	stub peco 'echo "url|1"'
	stub xdg-open 'url : '
	
	loin

	assertSuccessWithOutput ""

	unstub xdg-open
	unstub peco
	unstub buku
}
